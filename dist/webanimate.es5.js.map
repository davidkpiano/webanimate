{"version":3,"file":"webanimate.es5.js","sources":["../src/webanimate.ts"],"sourcesContent":["/// <reference types=\"web-animations-js\" />\n\ninterface WebAnimationKeyframeMap {\n  easing?: string;\n  offset?: (number | null | undefined)[];\n  [key: string]: string | number | (string | number | null | undefined)[] | undefined;\n}\n\ninterface WebAnimationKeyframe {\n  easing?: string;\n  offset?: number | null | undefined;\n  [key: string]: string | number | null | undefined;\n}\n\ninterface WebAnimationKeyframeOffsets {\n  [offset: string]: {\n    easing?: string | number;\n    [property: string]: string | number | undefined;\n  };\n}\n\nclass WebAnimator {\n  private styleElement: HTMLStyleElement;\n\n  constructor() {\n    this.styleElement = document.createElement('style');\n    this.styleElement.type = 'text/css';\n\n    document.getElementsByTagName('head')![0].appendChild(this.styleElement);\n  }\n\n  static getKeyframeOffsets(\n    keyframes: WebAnimationKeyframe[] | WebAnimationKeyframeMap\n  ): WebAnimationKeyframeOffsets {\n    const keyframeOffsets: WebAnimationKeyframeOffsets = {};\n\n    if (Array.isArray(keyframes)) {\n      const offsets = keyframes.map(k => k.offset);\n\n      for (let i = 0; i < keyframes.length; i++) {\n        const keyframe = keyframes[i];\n        let { offset } = keyframe;\n        let lowerOffset = 0;\n        let upperOffset = 1;\n        let offsetRange = offsets.length;\n\n        if (offset !== undefined && offset !== null) {\n          lowerOffset = offset;\n        } else if (i === 0) {\n          offset = offsets[i] = 0;\n        } else if (i === keyframes.length - 1) {\n          offset = offsets[i] = 1;\n        } else {\n          let lowerOffsetIndex = i;\n          let upperOffsetIndex = i;\n\n          while (--lowerOffsetIndex >= 0) {\n            if (offsets[lowerOffsetIndex] !== undefined) {\n              lowerOffset = offsets[lowerOffsetIndex]!;\n              break;\n            }\n          }\n          while (++upperOffsetIndex < offsets.length) {\n            if (offsets[upperOffsetIndex] !== undefined) {\n              upperOffset = offsets[upperOffsetIndex]!;\n              break;\n            }\n          }\n\n          offsetRange = upperOffsetIndex - lowerOffsetIndex;\n\n          offset = offsets[i] = Number.parseFloat(\n            (\n              lowerOffset +\n              (upperOffset - lowerOffset) * ((i - lowerOffsetIndex) / offsetRange)\n            ).toFixed(4)\n          );\n        }\n        keyframeOffsets[offset] = keyframeOffsets[offset] || {};\n\n        Object.keys(keyframe).forEach(property => {\n          if (property === 'offset') return;\n          const keyframeOffset = keyframeOffsets[offset as number];\n\n          keyframeOffset[property] = keyframe[property] as string | number;\n        });\n\n        if (keyframe.easing) {\n          keyframeOffsets[offset].easing = keyframe.easing;\n        }\n      }\n    } else {\n      const offsets = keyframes.offset;\n\n      Object.keys(keyframes).forEach(property => {\n        if (property === 'offset') return;\n\n        const propertyKeyframes = ([] as (string | number | null | undefined)[]).concat(\n          keyframes[property]!\n        );\n\n        if (!propertyKeyframes) return;\n\n        const propertyKeyframesArray = propertyKeyframes.map((value, i) => ({\n          [property]: value,\n          offset: offsets ? offsets[i] : undefined\n        }));\n\n        const propertyKeyframeOffsets = WebAnimator.getKeyframeOffsets(propertyKeyframesArray);\n\n        Object.keys(propertyKeyframeOffsets).forEach(offset => {\n          if (keyframeOffsets[offset]) {\n            Object.assign(keyframeOffsets[offset], propertyKeyframeOffsets[offset]);\n          } else {\n            keyframeOffsets[offset] = propertyKeyframeOffsets[offset];\n          }\n        });\n      });\n    }\n\n    return keyframeOffsets;\n  }\n\n  static getRuleString(property: string, value: any) {\n    return `${property}: ${value};\\n`;\n  }\n\n  addAnimation(element: HTMLElement, keyframes: WebAnimationKeyframe[] | WebAnimationKeyframeMap) {\n    const keyframeOffsets = WebAnimator.getKeyframeOffsets(keyframes);\n    const id = `anim-${Math.floor(Math.random() * 100)}`;\n\n    const offsetStrings = Object.keys(keyframeOffsets).map(offset => {\n      const rules = Object.keys(keyframeOffsets[offset]).map(property =>\n        WebAnimator.getRuleString(property, keyframeOffsets[offset][property])\n      );\n\n      return `${+offset * 100}% {\\n\\t\\t${rules.join('\\n\\t\\t')}\\n\\t}`;\n    });\n\n    const anim = `@keyframes ${id} {\\n\\t${offsetStrings.join('\\n\\t')}\\n}`;\n\n    element.style.setProperty('animation', `${id} 1s infinite`);\n    this.styleElement.innerHTML = anim;\n  }\n}\n\nconst as = new WebAnimator();\n\nas.addAnimation(document.body, [\n  { 'background-color': 'blue' },\n  { 'background-color': 'green', offset: 0.5 },\n  { 'background-color': 'red' },\n  { 'background-color': 'yellow', offset: 0.8 },\n  { 'background-color': 'pink' }\n]);\n"],"names":[],"mappings":"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"}